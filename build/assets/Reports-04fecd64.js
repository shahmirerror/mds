import{r as l,j as e,a as ne}from"./app-39c368c7.js";import{A as ce}from"./AuthenticatedLayout-3c3e3819.js";import{S as v}from"./react-select.esm-dd8b99cd.js";import{Q as ie,B as c}from"./ReactToastify-35e89cca.js";import{I as A}from"./IconDownload-e099d298.js";import"./createReactComponent-3d9c90ae.js";import"./index-eb642c4a.js";function ve({auth:I}){const[L,Q]=l.useState([]),[K,U]=l.useState([]),[V,$]=l.useState([]),[S,F]=l.useState([]),[j,R]=l.useState([]),[p,O]=l.useState([]),[z,W]=l.useState([]),X=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],[Z,h]=l.useState(null),[de,ee]=l.useState(!0),[n,Y]=l.useState(null),t=new Date;let y;t.getMonth()+1>=10?y=t.getFullYear()-1+"-"+(t.getMonth()+1)+"-"+t.getDate():y=t.getFullYear()-1+"-0"+(t.getMonth()+1)+"-"+t.getDate();const r=new Date(y),[b,_]=l.useState(t.getMonth()+1>=10?t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate():t.getFullYear()+"-0"+(t.getMonth()+1)+"-"+t.getDate()),[C,q]=l.useState(t.getFullYear()),[N,P]=l.useState(t.getMonth()+1),[D,E]=l.useState(t.getMonth()+1>=10?t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate():t.getFullYear()+"-0"+(t.getMonth()+1)+"-"+t.getDate()),[k,T]=l.useState(r.getMonth()+1>=10?r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate():r.getFullYear()+"-0"+(r.getMonth()+1)+"-"+r.getDate()),[u,B]=l.useState(null),[g,H]=l.useState(0),[w,G]=l.useState([]),te=()=>{try{const s=fetch(route("super.reports.fetch_centres"),{method:"GET"}).then(a=>a.json()).then(a=>{Q(a.centres)},a=>{console.log(a)})}catch(s){console.error(s)}},se=()=>{try{const s=fetch(route("super.reports.fetch_reports"),{method:"GET"}).then(a=>a.json()).then(a=>{U(a.modules)},a=>{console.log(a)})}catch(s){console.error(s)}},ae=()=>{try{const s=fetch(route("super.reports.fetch_countries"),{method:"GET"}).then(a=>a.json()).then(a=>{$(a.countries)},a=>{console.log(a)})}catch(s){console.error(s)}},le=s=>{s.preventDefault(),ee(!0),h(null),Y(null),_(t.getMonth()+1>=10?t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate():t.getFullYear()+"-0"+(t.getMonth()+1)+"-"+t.getDate()),q(t.getFullYear()),P(t.getMonth()+1),E(t.getMonth()+1>=10?t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate():t.getFullYear()+"-0"+(t.getMonth()+1)+"-"+t.getDate()),T(r.getMonth()+1>=10?r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate():r.getFullYear()+"-0"+(r.getMonth()+1)+"-"+r.getDate()),H(0),B(0),G([]),F([]),O([]),R([])},re=async s=>{if(s.preventDefault(),n==null)M("Data Frequency");else if(g==0)M("Centre");else if(u==null)M("Report Type");else{h(["generate"]);const i=JSON.stringify({datafreq:n,dailydate:b,monthlydate:N,yearlydate:C,fromRange:k,toRange:D,centreID:g,countries:w,report_type:u});try{const d=await c.promise(fetch(route("super.reports.generate_report"),{method:"POST",body:i}),{pending:"Fetching Report"}).then(o=>o.json()).then(o=>{var f;F(o.data),R(o.keys),h(null),((f=o.data)==null?void 0:f.length)>0?c.success("Report has been generated!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}):c.error("No data could be find based on your query!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})},o=>{h(null),c.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})})}catch{h(null),c.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}}},x=s=>{Y(s.target.value)},M=s=>{c.warning("Please select a "+s+" first!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})},J=async s=>{s.preventDefault();const i=JSON.stringify({datafreq:n,dailydate:b,monthlydate:N,yearlydate:C,fromRange:k,toRange:D,centreID:g,countries:w,report_type:u,keys:j,data:S});try{const d=await c.promise(fetch(route("super.reports.export_report",s.target.value),{method:"POST",body:i}),{pending:"Generating File"}).then(o=>o.json()).then(o=>{document.body.removeChild(m),c.success("Report has been exported!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"});const f=o.filename,m=document.createElement("a");m.href=f,m.download=data.filename,document.body.appendChild(m),m.click()},o=>{c.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})})}catch{c.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}},oe=s=>{const a=s.target.value;W(a);const i=S.filter(d=>Object.values(d).some(o=>typeof o=="string"&&o.toLowerCase().includes(a.toLowerCase())));O(i)};return l.useEffect(()=>{se(),te(),ae()},[]),e.jsxs(ce,{user:I.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Reports"}),children:[e.jsx(ne,{title:"Reports"}),e.jsx(ie,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"}),e.jsx("div",{className:"page-header d-print-none",children:e.jsx("div",{className:"container-xl",children:e.jsx("div",{className:"row g-2 align-items-center",children:e.jsx("div",{className:"col",children:e.jsx("h2",{className:"page-title",children:"Reports"})})})})}),e.jsx("div",{className:"page-body",children:e.jsxs("div",{className:"container-xl",children:[e.jsxs("div",{className:"row row-deck row-cards",children:[e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{className:"form-label",children:"Select Centre"}),e.jsx(v,{options:L,value:g,name:"centreID",onChange:H})]})}),e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"Data Frequency"}),e.jsxs("div",{children:[e.jsxs("label",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"data_freq",value:"Daily",checked:n=="Daily",onChange:x}),e.jsx("span",{className:"form-check-label",children:"Daily"})]}),e.jsxs("label",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"data_freq",value:"Yearly",checked:n=="Yearly",onChange:x}),e.jsx("span",{className:"form-check-label",children:"Yearly"})]}),e.jsxs("label",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"data_freq",value:"Monthly",checked:n=="Monthly",onChange:x}),e.jsx("span",{className:"form-check-label",children:"Monthly"})]}),e.jsxs("label",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"data_freq",value:"Custom Date Range",checked:n=="Custom Date Range",onChange:x}),e.jsx("span",{className:"form-check-label",children:"Custom Date Range"})]})]})]})}),n=="Daily"?e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"Choose Date"}),e.jsx("input",{className:"form-control",type:"date",name:"daily_date",value:b,onChange:s=>_(s.target.value)})]})}):n=="Monthly"?e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"Choose Month(s)"}),e.jsx(v,{options:X,value:N,name:"monthly_date",onChange:P})]})}):n=="Yearly"?e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"Choose Year"}),e.jsx("input",{className:"form-control",type:"text",name:"yearly_date",placeholder:"Enter Year e.g. 2024",value:C,onChange:s=>q(s.target.value)})]})}):n=="Custom Date Range"?e.jsxs("div",{className:"col-sm-6 col-lg-3",style:{justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"From"}),e.jsx("input",{className:"form-control form-date-picker",type:"date",name:"from_date_range",value:k,onChange:s=>T(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"To"}),e.jsx("input",{className:"form-control",type:"date",name:"to_date_range",value:D,onChange:s=>E(s.target.value)})]})]}):e.jsx(e.Fragment,{})]}),e.jsxs("div",{className:"row row-deck row-cards",children:[e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{className:"form-label",children:"Report Type"}),e.jsx(v,{options:K,value:u,name:"report_type",onChange:B})]})}),e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{className:"form-label",children:"Countries"}),e.jsx(v,{options:V,value:w,name:"country",isMulti:!0,onChange:G})]})})]}),e.jsx("div",{className:"mt-3 row row-deck row-cards mb-3",style:{justifyContent:"flex-end"},children:e.jsx("div",{className:"col-sm-6 col-lg-3",style:{justifyContent:"space-between"},children:e.jsxs("div",{className:"col-12",style:{display:"inline-flex",justifyContent:"space-between"},children:[e.jsx("button",{type:"submit",className:"btn btn-primary",onClick:re,disabled:Z!==null,children:"Generate Report"}),e.jsx("button",{type:"submit",className:"btn btn-secondary",disabled:g==0&&u==0&&n==null,onClick:le,children:"Reset Selection"})]})})}),(p==null?void 0:p.length)>0?e.jsx("div",{className:"row row-deck row-cards",children:e.jsxs("div",{class:"card",children:[e.jsxs("div",{className:"card-header",style:{display:"inline-flex",justifyContent:"space-between"},children:[e.jsx("h2",{class:"page-title",children:"Query Result"}),e.jsxs("div",{children:[e.jsxs("button",{className:"btn btn-sm btn-success text-white mr-2",value:"csv",onClick:J,children:["Export CSV",e.jsx(A,{})]}),e.jsxs("button",{className:"btn btn-sm btn-danger text-white ml-2",value:"pdf",onClick:J,children:["Export PDF",e.jsx(A,{})]})]})]}),e.jsx("div",{class:"card-body border-bottom py-3",children:e.jsx("div",{class:"d-flex",children:e.jsxs("div",{class:"ms-auto text-secondary",children:["Search:",e.jsx("div",{class:"ms-2 d-inline-block",children:e.jsx("input",{type:"text",class:"form-control form-control-sm","aria-label":"Search",value:z,onChange:oe})})]})})}),e.jsx("div",{class:"card-body",children:e.jsx("div",{id:"table-default",class:"table-responsive",children:e.jsxs("table",{class:"table",children:[e.jsx("thead",{children:e.jsx("tr",{children:j.map((s,a)=>e.jsx("th",{children:e.jsx("button",{class:"table-sort","data-sort":"sort-name",children:s.name.replaceAll("_"," ")})}))})}),e.jsx("tbody",{class:"table-tbody",children:p.map((s,a)=>e.jsx("tr",{children:j.map((i,d)=>e.jsx("td",{class:"sort-name",children:s[i.name]}))}))})]})})})]})}):e.jsx(e.Fragment,{})]})})]})}export{ve as default};
