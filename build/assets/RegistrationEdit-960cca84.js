import{r as h,W as G,j as e,a as W}from"./app-5171a690.js";import{A as U}from"./AuthenticatedLayout-4e957625.js";import"./TextInput-5a339876.js";import{Q as A,B as d}from"./ReactToastify-6eb4a479.js";import{S as x}from"./react-select.esm-87bf2223.js";import{I as Q}from"./IconRefresh-f9c9b4c7.js";import"./createReactComponent-6ff81172.js";import"./index-15298e3e.js";function te(o){const[f,C]=h.useState("None"),{data:l,setData:c,post:k,processing:X,errors:$,reset:P}=G({passport_no:"",passport_issue_date:"",passport_expiry_date:"",candidate_name:"",candidate_image:null,passport_image:null,agency:"",country:"",profession:"",cnic:"",gender:"",finger_type:"",dob:"",place_of_issue:"",reg_date:"",barcode:o.barcode,serial_no:"",relation_type:"",relative_name:"",phone_1:"",phone_2:"",nationality:"",marital_status:"",biometric_fingerprint:"",fee_charged:"",discount:"",remarks:"",pregnancy_test:0,repeat:!1,token_no:f}),S=[{value:"L-Thumb",label:"L-Thumb"},{value:"L-Index Finger",label:"L-Index Finger"},{value:"L-Middle Finger",label:"L-Middle Finger"},{value:"L-Ring Finger",label:"L-Ring Finger"},{value:"L-Pinky Finger",label:"L-Pinky Finger"},{value:"R-Thumb",label:"R-Thumb"},{value:"R-Index Finger",label:"R-Index Finger"},{value:"R-Middle Finger",label:"R-Middle Finger"},{value:"R-Ring Finger",label:"R-Ring Finger"},{value:"R-Pinky Finger",label:"R-Pinky Finger"}];function O(s,t=5e3){return new Promise((r,a)=>{const i=setTimeout(()=>a("Element not found"),t),m=new MutationObserver(g=>{for(const u of g){const w=u.target;if(w.matches(s)){clearTimeout(i),m.disconnect(),r(w);return}}});m.observe(document.body,{childList:!0,subtree:!0}),document.querySelector(s)&&(clearTimeout(i),m.disconnect(),r(document.querySelector(s)))})}const[p,v]=h.useState(!1);h.useState(null);const[j,b]=h.useState(!1),[I,z]=h.useState(""),[N,y]=h.useState(null),[K,T]=h.useState(null),E=s=>{if(p){v(!1);let t=document.getElementById("video"),r=document.getElementById("photo-placeholder");s.target.innerHTML="Turn Camera On",s.target.classList.value="btn btn-success btn-md",N.getTracks().forEach(a=>a.stop()),r.style.display="block",t.style.display="none"}else v(!0),s.target.innerHTML="Turn Camera Off",s.target.classList.value="btn btn-danger btn-md",O("#video").then(t=>{let r=document.getElementById("video"),a=document.getElementById("photo-placeholder");navigator.mediaDevices.enumerateDevices().then(i=>{const m=i.filter(g=>g.kind==="videoinput");if(m.length>0){const u={video:{deviceId:m[0].deviceId}};return navigator.mediaDevices.getUserMedia(u)}else throw new Error("No video input devices found.")}).then(i=>{y(i),a.style.display="none",r.style.display="block",r.srcObject=i}).catch(i=>{console.error("Error accessing webcam:",i)})}).catch(t=>{console.error(t)})},_=s=>{let t=document.getElementById("video"),r=document.getElementById("taken_photo");if(s.target.value=="take"){const a=document.createElement("canvas");a.width=t.videoWidth,a.height=t.videoHeight,a.getContext("2d").drawImage(t,0,0),r.src=a.toDataURL("image/png"),t.style.display="none",r.style.display="block";const m=new Blob([a.toDataURL("image/png").replace("data:image/png;base64,","")],{type:"image/png"}),g="webcam_photo_"+Date.now()+".png",u=new File([m],g,{type:"image/png"});c("candidate_image",u)}else s.target.value=="retake"&&(c("candidate_image",null),t.style.display="block",r.style.display="none")},F=()=>{const s={centre_id:o.auth.user.centre.centre_id,process_id:1},t=JSON.stringify(s);try{const r=fetch(route("token.assign"),{method:"POST",body:t}).then(a=>a.json()).then(a=>{C(a.new_token),d.success("New Token has been set!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})},a=>{d.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})})}catch{d.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}},R=()=>{const s={centre_id:o.auth.user.centre.centre_id},t=JSON.stringify(s);try{const r=fetch(route("barcode.new"),{method:"POST",body:t}).then(a=>a.json()).then(a=>{c("barcode",a.new_barcode)},a=>{console.log(a)})}catch(r){console.log(r)}},D=()=>{F(),P(),R(),N!==null&&N.getTracks().forEach(i=>i.stop()),document.getElementById("fingerPrint").src="./../assets/static/photos/ThumbPrint.png";let s=document.getElementById("video"),t=document.getElementById("photo-placeholder"),r=document.getElementById("taken_photo");t.style.display="block",s.style.display="none",r.style.display="none";let a=document.getElementById("cameraToggle");a.innerHTML="Turn Camera On",a.classList.value="btn btn-success btn-md",v(!1),b(!1),y(!1),T(null)};function B(s,t){var r="https://localhost:8443/SGIFPCapture",a=new XMLHttpRequest;a.onreadystatechange=function(){a.readyState==4&&a.status==200?s(JSON.parse(a.responseText)):a.status==404&&t(a.status)},a.onerror=function(){t(a.status)};var i="Timeout=10000";i+="&Quality=50",i+="&licstr="+encodeURIComponent(I),i+="&templateFormat=ISO",a.open("POST",r,!0),a.send(i)}function L(s){s.ErrorCode==0?(s!=null&&s.BMPBase64.length>0&&(document.getElementById("fingerPrint").src="data:image/bmp;base64,"+s.BMPBase64),c("biometric_fingerprint",s.TemplateBase64)):d.error("Fingerprint Capture Error Code:  "+s.ErrorCode,{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}function M(s){d.warning("Check if Fingerprint Scanner is running!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}const H=s=>{s.preventDefault(),B(L,M)},q=s=>{const t={centre_id:o.auth.user.centre.centre_id,counter_id:1},r=JSON.stringify(t);try{const a=fetch(route("ppscan.new"),{method:"POST",body:r}).then(i=>i.json()).then(i=>{i.pp_info.length==0?d.warning("No Passport Found!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}):d.success("Passport Found!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})},i=>{d.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})})}catch{d.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}},n=s=>{s.target.name=="gender"&&c("pregnancy_test",0),c(s.target.name,s.target.value)},J=s=>{k(route("registration-desk.store"))};return h.useEffect(()=>{D()},[]),e.jsxs(U,{user:o.auth.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Registration Desk - Edit"}),children:[e.jsx(W,{title:"Registration Desk - Edit"}),e.jsx(A,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"}),e.jsx("div",{className:"page-header d-print-none",children:e.jsx("div",{className:"container-xl",children:e.jsx("div",{className:"row g-2 align-items-center",children:e.jsxs("div",{className:"col align-items-center",children:[e.jsx("div",{className:"col-md-3",style:{float:"left"},children:e.jsx("h2",{className:"page-title",style:{float:"left"},children:"Registration Desk - Edit"})}),e.jsx("div",{className:"col-md-3 align-items-center",style:{float:"right"},children:e.jsx("h2",{className:"page-title",children:e.jsx("button",{className:"btn btn-secondary btn-sm mr-5 btn-pill",onClick:"",children:e.jsx(Q,{})})})})]})})})}),e.jsx("div",{className:"page-body",children:e.jsxs("div",{className:"container-xl",children:[e.jsxs("div",{className:"row row-cards mb-5",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"row row-cards",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"col-md-12 flex align-items-center"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("img",{id:"fingerPrint",src:"./../../assets/static/photos/ThumbPrint.png",style:{width:500}}),e.jsx("div",{className:"col-md-12 text-center",children:e.jsx("button",{className:"btn btn-purple btn-md w-50",onClick:H,children:"Scan fingerprint"})}),e.jsx("div",{className:"col-md-12 text-center",children:e.jsxs("select",{className:"form-select",name:"finger_type",onChange:n,children:[e.jsx("option",{children:"--"}),S.map((s,t)=>e.jsx("option",{value:s.value,children:s.label}))]})})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("video",{id:"video",autoPlay:!0,muted:!0,style:{height:"280px",display:"none"}}),e.jsx("img",{src:null,id:"taken_photo",style:{width:300,display:"none",marginTop:"55px"},className:"mb-5"}),e.jsx("img",{src:"./../assets/static/photos/Photo.png",className:"mb-4",id:"photo-placeholder",style:{width:274}}),e.jsx("div",{className:"col-md-6",children:p&&l.candidate_image==null?e.jsx("button",{className:"btn btn-warning btn-md",value:"take",onClick:_,children:"Take Photo"}):p&&l.candidate_image!=null?e.jsx("button",{className:"btn btn-warning btn-md",value:"retake",onClick:_,children:"Re-Take Photo"}):e.jsx(e.Fragment,{})}),e.jsx("div",{className:"col-md-6",children:e.jsx("button",{className:"btn btn-success btn-md",id:"cameraToggle",disabled:l.candidate_image!=null,onClick:E,children:"Turn Camera On"})})]})})]})})]})})})}),e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"row row-cards",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"col-md-12 flex align-items-center",children:[e.jsx("div",{className:"col-md-6",style:{float:"left"},children:j?e.jsx("h3",{children:"Passport Information"}):e.jsx("button",{className:"btn btn-sm btn-yellow",onClick:q,children:"Import Passport"})}),e.jsx("div",{className:"col-md-6",style:{float:"right"},children:e.jsxs("label",{class:"form-check form-switch",style:{float:"right"},children:[e.jsx("input",{class:"form-check-input",type:"checkbox",checked:j,onChange:s=>b(s.target.checked)}),e.jsx("span",{class:"form-check-label",children:"Manual Entry"})]})})]})}),j?e.jsxs("div",{className:"card-body",id:"manual_import",children:[e.jsxs("div",{className:"row g-5 mb-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Candidate Name"}),e.jsx("input",{type:"text",className:"form-control",name:"candidate_name",value:l.candidate_name,onChange:n})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Passport Number"}),e.jsx("input",{type:"text",className:"form-control",name:"passport_no",value:l.passport_no,onChange:n})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"PP Issue Date"}),e.jsx("input",{type:"date",className:"form-control",name:"passport_issue_date",value:l.passport_issue_date,onChange:n})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"PP Expiry Date"}),e.jsx("input",{type:"date",className:"form-control",name:"passport_expiry_date",value:l.passport_expiry_date,onChange:n})]})}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"DOB"}),e.jsx("input",{type:"date",className:"form-control",name:"dob",value:l.dob,onChange:n})]})}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Gender"}),e.jsxs("select",{className:"form-control",name:"gender",onChange:n,children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"})]})]})}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Passport Image"}),e.jsx("input",{type:"file",className:"form-control",name:"passport_image",onChange:s=>c("passport_image",s.target.files[0])})]})})]}),e.jsxs("div",{className:"row g-5 mb-3",children:[e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Nationality"}),e.jsx("input",{type:"text",className:"form-control",name:"nationality",value:l.nationality,onChange:n})]})}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"CNIC"}),e.jsx("input",{type:"text",className:"form-control",name:"cnic",value:l.cnic,onChange:n})]})}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Place of Issue"}),e.jsx(x,{options:o.places,value:l.place_of_issue,name:"place_of_issue",onChange:s=>c("place_of_issue",s)})]})})]}),e.jsxs("div",{className:"row g-5",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Reference Slip Issue Date"}),e.jsx("input",{type:"date",className:"form-control",name:"ref_slip_issue_date",value:l.ref_slip_issue_date,onChange:n})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Reference Slip Expiry Date"}),e.jsx("input",{type:"date",className:"form-control",name:"ref_slip_expiry_date",value:l.ref_slip_expiry_date,onChange:n})]})})]})]}):e.jsxs("div",{className:"card-body",id:"auto_import",children:[e.jsxs("div",{className:"row g-5 mb-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Place of Issue"}),e.jsx(x,{options:o.places,value:l.place_of_issue,name:"place_of_issue",onChange:s=>c("place_of_issue",s)})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"PP Issue Date"}),e.jsx("input",{type:"date",className:"form-control",name:"passport_issue_date",onChange:n})]})})]}),e.jsxs("div",{className:"row g-5",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Reference Slip Issue Date"}),e.jsx("input",{type:"date",className:"form-control",name:"ref_slip_issue_date",value:l.ref_slip_issue_date,onChange:n})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Reference Slip Expiry Date"}),e.jsx("input",{type:"date",className:"form-control",name:"ref_slip_expiry_date",value:l.ref_slip_expiry_date,onChange:n})]})})]})]})]})})})})]}),e.jsxs("div",{className:"row row-cards",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"row row-cards",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"col-md-12 flex align-items-center",children:e.jsx("div",{className:"col-md-6",style:{float:"left"},children:e.jsx("h3",{children:"General Information"})})})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-5 mb-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Registration Date"}),e.jsx("input",{type:"date",className:"form-control",name:"reg_date",value:l.reg_date,onChange:n})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Serial Number"}),e.jsx("input",{type:"text",className:"form-control",name:"serial_no",value:l.serial_no,onChange:n})]})})]}),e.jsxs("div",{className:"row g-5 mb-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Agency"}),e.jsx(x,{options:o.agencies,value:l.agency,name:"agencies",onChange:s=>c("agency",s)})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Country"}),e.jsx(x,{options:o.countries,value:l.country,name:"country",onChange:s=>c("country",s)})]})})]}),e.jsxs("div",{className:"row g-5 mb-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Profession"}),e.jsx(x,{options:o.professions,value:l.profession,name:"profession",onChange:s=>c("profession",s)})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Fees"}),e.jsx("input",{className:"form-control",name:"fees",type:"text",value:l.fees,onChange:n})]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Discount"}),e.jsx("input",{className:"form-control",name:"discount",type:"text",value:l.discount,onChange:n})]})})]})]})]})})})}),e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"row row-cards",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"col-md-12 flex align-items-center",children:e.jsx("div",{className:"col-md-6",style:{float:"left"},children:e.jsx("h3",{children:"Candidate Information"})})})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-5 mb-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Relation"}),e.jsxs("select",{className:"form-select",name:"relation_type",value:l.relation_type,onChange:n,children:[e.jsx("option",{value:"",children:"Select Relation"}),e.jsx("option",{value:"S/O",children:"S/O"}),e.jsx("option",{value:"W/O",children:"W/O"}),e.jsx("option",{value:"D/O",children:"D/O"})]})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Relative Name"}),e.jsx("input",{type:"text",className:"form-control",name:"relative_name",value:l.relative_name,onChange:n})]})})]}),e.jsxs("div",{className:"row g-5 mb-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Phone 1"}),e.jsx("input",{type:"text",className:"form-control",name:"phone_1",value:l.phone_1,onChange:n})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Phone 2"}),e.jsx("input",{type:"text",className:"form-control",name:"phone_2",value:l.phone_2,onChange:n})]})})]}),e.jsxs("div",{className:"row g-5",children:[e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Pregnancy Check"}),e.jsxs("select",{className:"form-select",disabled:l.gender=="Male",name:"pregnancy_test",value:l.pregnancy_test,onChange:n,children:[e.jsx("option",{value:"1",children:"Pregnant"}),e.jsx("option",{value:"0",children:"Not Pregnant"})]})]})}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Marital Status"}),e.jsxs("select",{className:"form-select",name:"marital_status",value:l.marital_status,onChange:n,children:[e.jsx("option",{value:"",children:"Select Marital Status"}),e.jsx("option",{value:"Single",children:"Single"}),e.jsx("option",{value:"Married",children:"Married"}),e.jsx("option",{value:"Divorced",children:"Divorced"}),e.jsx("option",{value:"Widowed",children:"Widowed"})]})]})}),e.jsx("div",{className:"col-4",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("label",{className:"form-label",children:"Remarks"}),e.jsx("textarea",{className:"form-control",name:"remarks",value:l.remarks,onChange:n})]})})]})]}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"row g-5",children:e.jsx("div",{className:"col-12",children:e.jsx("button",{className:"btn btn-outline-success",disabled:f=="None",onClick:J,children:"Submit"})})})})]})})})})]})]})})]})}export{te as default};
