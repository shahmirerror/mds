import{r as a,j as e,a as Z}from"./app-352b439c.js";import{A as ee}from"./AuthenticatedLayout-cb43d4e9.js";import{S}from"./react-select.esm-7ea73a93.js";import{Q as te,B as n}from"./ReactToastify-915dd701.js";import{I as A}from"./IconDownload-f63d9009.js";import"./createReactComponent-d4a20834.js";function ie({auth:O}){a.useState([]);const[G,I]=a.useState([]),[K,L]=a.useState([]),[d,M]=a.useState([]),[f,R]=a.useState([]),Q=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],[U,F]=a.useState(null),[V,m]=a.useState(!0),[r,q]=a.useState(null),s=new Date;let v;s.getMonth()+1>=10?v=s.getFullYear()-1+"-"+(s.getMonth()+1)+"-"+s.getDate():v=s.getFullYear()-1+"-0"+(s.getMonth()+1)+"-"+s.getDate();const i=new Date(v),[j,P]=a.useState(s.getFullYear()+"-"+s.getMonth()+1+"-"+s.getDate()),[b,Y]=a.useState(s.getFullYear()),[y,_]=a.useState(s.getMonth()+1),[C,E]=a.useState(s.getFullYear()+"-"+s.getMonth()+1+"-"+s.getDate()),[N,B]=a.useState(i.getFullYear()+"-"+i.getMonth()+1+"-"+i.getDate()),[c,T]=a.useState(null),[k,se]=a.useState(O.centre.id),[D,H]=a.useState([]),$=()=>{try{const t=fetch(route("admin.reports.fetch_reports"),{method:"GET"}).then(l=>l.json()).then(l=>{I(l.modules)},l=>{console.log(l)})}catch(t){console.error(t)}},z=()=>{try{const t=fetch(route("admin.reports.fetch_countries"),{method:"GET"}).then(l=>l.json()).then(l=>{L(l.countries)},l=>{console.log(l)})}catch(t){console.error(t)}},W=t=>{t.preventDefault(),m(!0),F(null),q(null),P(s.getFullYear()+"-"+s.getMonth()+1+"-"+s.getDate()),Y(s.getFullYear()),_(s.getMonth()+1),E(s.getFullYear()+"-"+s.getMonth()+1+"-"+s.getDate()),B(i.getFullYear()+"-"+i.getMonth()+1+"-"+i.getDate()),T(0),H([]),M([]),R([])},X=t=>{if(t.preventDefault(),r==null)w("Data Frequency");else if(k==0)w("Centre");else if(c==0)w("Report Type");else{F(["generate"]);const h=JSON.stringify({datafreq:r,dailydate:j,monthlydate:y,yearlydate:b,fromRange:N,toRange:C,centreID:k,countries:D,report_type:c});try{const p=fetch(route("admin.reports.generate_report"),{method:"POST",body:h}).then(o=>o.json()).then(o=>{var x;M(o.data),R(o.keys),m(!1),((x=o.data)==null?void 0:x.length)>0?n.success("Report has been generated!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}):n.error("No data could be find based on your query!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})},o=>{m(!1),n.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})})}catch{m(!1),n.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}}},g=t=>{q(t.target.value)},w=t=>{n.warning("Please select a "+t+" first!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})},J=t=>{t.preventDefault();const h=JSON.stringify({datafreq:r,dailydate:j,monthlydate:y,yearlydate:b,fromRange:N,toRange:C,centreID:k,countries:D,report_type:c,keys:f,data:d});try{const p=fetch(route("admin.reports.export_report",t.target.value),{method:"POST",body:h}).then(o=>o.json()).then(o=>{const x=o.filename,u=document.createElement("a");u.href=x,u.download=data.filename,document.body.appendChild(u),u.click(),document.body.removeChild(u),n.success("Report has been exported!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})},o=>{n.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})})}catch{n.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}};return a.useEffect(()=>{$(),z()},[]),e.jsxs(ee,{user:O.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Reports"}),children:[e.jsx(Z,{title:"Reports"}),e.jsx(te,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"}),e.jsx("div",{className:"page-header d-print-none",children:e.jsx("div",{className:"container-xl",children:e.jsx("div",{className:"row g-2 align-items-center",children:e.jsx("div",{className:"col",children:e.jsx("h2",{className:"page-title",children:"Reports"})})})})}),e.jsx("div",{className:"page-body",children:e.jsxs("div",{className:"container-xl",children:[e.jsxs("div",{className:"row row-deck row-cards",children:[e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{className:"form-label",children:"Report Type"}),e.jsx(S,{options:G,value:c,name:"report_type",onChange:T})]})}),e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"Data Frequency"}),e.jsxs("div",{children:[e.jsxs("label",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"data_freq",value:"Daily",checked:r=="Daily",onChange:g}),e.jsx("span",{className:"form-check-label",children:"Daily"})]}),e.jsxs("label",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"data_freq",value:"Yearly",checked:r=="Yearly",onChange:g}),e.jsx("span",{className:"form-check-label",children:"Yearly"})]}),e.jsxs("label",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"data_freq",value:"Monthly",checked:r=="Monthly",onChange:g}),e.jsx("span",{className:"form-check-label",children:"Monthly"})]}),e.jsxs("label",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"data_freq",value:"Custom Date Range",checked:r=="Custom Date Range",onChange:g}),e.jsx("span",{className:"form-check-label",children:"Custom Date Range"})]})]})]})}),r=="Daily"?e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"Choose Date"}),e.jsx("input",{className:"form-control",type:"date",name:"daily_date",value:j,onChange:t=>P(t.target.value)})]})}):r=="Monthly"?e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"Choose Month(s)"}),e.jsx(S,{options:Q,value:y,name:"monthly_date",onChange:_})]})}):r=="Yearly"?e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"Choose Year"}),e.jsx("input",{className:"form-control",type:"text",name:"yearly_date",placeholder:"Enter Year e.g. 2024",value:b,onChange:t=>Y(t.target.value)})]})}):r=="Custom Date Range"?e.jsxs("div",{className:"col-sm-6 col-lg-3",style:{justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"From"}),e.jsx("input",{className:"form-control form-date-picker",type:"date",name:"from_date_range",value:N,onChange:t=>B(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"To"}),e.jsx("input",{className:"form-control",type:"date",name:"to_date_range",value:C,onChange:t=>E(t.target.value)})]})]}):e.jsx(e.Fragment,{})]}),e.jsx("div",{className:"row row-deck row-cards",children:e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{className:"form-label",children:"Countries"}),e.jsx(S,{options:K,value:D,name:"country",isMulti:!0,onChange:H})]})})}),e.jsx("div",{className:"mt-3 row row-deck row-cards mb-3",style:{justifyContent:"flex-end"},children:e.jsx("div",{className:"col-sm-6 col-lg-3",style:{justifyContent:"space-between"},children:e.jsxs("div",{className:"col-12",style:{display:"inline-flex",justifyContent:"space-between"},children:[e.jsx("button",{type:"submit",className:"btn btn-primary",onClick:X,disabled:U!==null,children:"Generate Report"}),e.jsx("button",{type:"submit",className:"btn btn-secondary",disabled:V,onClick:W,children:"Reset Selection"})]})})}),(d==null?void 0:d.length)>0?e.jsx("div",{className:"row row-deck row-cards",children:e.jsxs("div",{class:"card",children:[e.jsxs("div",{className:"card-header",style:{display:"inline-flex",justifyContent:"space-between"},children:[e.jsxs("h2",{class:"page-title",children:[c==null?void 0:c.label," - Result"]}),e.jsxs("div",{children:[e.jsxs("button",{className:"btn btn-sm btn-success text-white mr-2",value:"csv",onClick:J,children:["Export CSV",e.jsx(A,{})]}),e.jsxs("button",{className:"btn btn-sm btn-danger text-white ml-2",value:"pdf",onClick:J,children:["Export PDF",e.jsx(A,{})]})]})]}),e.jsx("div",{class:"card-body border-bottom py-3",children:e.jsx("div",{class:"d-flex",children:e.jsxs("div",{class:"ms-auto text-secondary",children:["Search:",e.jsx("div",{class:"ms-2 d-inline-block",children:e.jsx("input",{type:"text",class:"form-control form-control-sm","aria-label":"Search"})})]})})}),e.jsx("div",{class:"card-body",children:e.jsx("div",{id:"table-default",class:"table-responsive",children:e.jsxs("table",{class:"table",children:[e.jsx("thead",{children:e.jsx("tr",{children:f.map((t,l)=>e.jsx("th",{children:e.jsx("button",{class:"table-sort","data-sort":"sort-name",children:t.name.replaceAll("_"," ")})}))})}),e.jsx("tbody",{class:"table-tbody",children:d.map((t,l)=>e.jsx("tr",{children:f.map((h,p)=>e.jsx("td",{class:"sort-name",children:t[h.name]}))}))})]})})})]})}):e.jsx(e.Fragment,{})]})})]})}export{ie as default};
