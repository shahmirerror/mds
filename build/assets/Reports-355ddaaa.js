import{r as l,j as e,a as ee}from"./app-72f3f2f1.js";import{A as te}from"./AuthenticatedLayout-88e4a52b.js";import{S as g}from"./react-select.esm-de1e1664.js";import{Q as se,B as d}from"./ReactToastify-d62874cc.js";import{I as B}from"./IconDownload-bd7b024e.js";import"./createReactComponent-467ac043.js";function de({auth:G}){const[H,A]=l.useState([]),[J,I]=l.useState([]),[K,L]=l.useState([]),[h,f]=l.useState([]),[v,y]=l.useState([]),Q=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],[V,i]=l.useState(null),[ae,$]=l.useState(!0),[r,b]=l.useState(null),s=new Date;let p;s.getMonth()+1>=10?p=s.getFullYear()-1+"-"+(s.getMonth()+1)+"-"+s.getDate():p=s.getFullYear()-1+"-0"+(s.getMonth()+1)+"-"+s.getDate();const o=new Date(p),[N,C]=l.useState(s.getFullYear()+"-"+s.getMonth()+1+"-"+s.getDate()),[D,k]=l.useState(s.getFullYear()),[w,S]=l.useState(s.getMonth()+1),[M,R]=l.useState(s.getFullYear()+"-"+s.getMonth()+1+"-"+s.getDate()),[F,O]=l.useState(o.getFullYear()+"-"+o.getMonth()+1+"-"+o.getDate()),[n,Y]=l.useState(null),[u,_]=l.useState(0),[q,P]=l.useState([]),z=()=>{try{const t=fetch(route("super.reports.fetch_centres"),{method:"GET"}).then(a=>a.json()).then(a=>{A(a.centres)},a=>{console.log(a)})}catch(t){console.error(t)}},U=()=>{try{const t=fetch(route("super.reports.fetch_reports"),{method:"GET"}).then(a=>a.json()).then(a=>{I(a.modules)},a=>{console.log(a)})}catch(t){console.error(t)}},W=()=>{try{const t=fetch(route("super.reports.fetch_countries"),{method:"GET"}).then(a=>a.json()).then(a=>{L(a.countries)},a=>{console.log(a)})}catch(t){console.error(t)}},X=t=>{t.preventDefault(),$(!0),i(null),b(null),C(s.getFullYear()+"-"+s.getMonth()+1+"-"+s.getDate()),k(s.getFullYear()),S(s.getMonth()+1),R(s.getFullYear()+"-"+s.getMonth()+1+"-"+s.getDate()),O(o.getFullYear()+"-"+o.getMonth()+1+"-"+o.getDate()),_(0),Y(0),P([]),f([]),y([])},Z=t=>{if(t.preventDefault(),r==null)x("Data Frequency");else if(u==0)x("Centre");else if(n==0)x("Report Type");else{i(["generate"]);const j=JSON.stringify({datafreq:r,dailydate:N,monthlydate:w,yearlydate:D,fromRange:F,toRange:M,centreID:u,countries:q,report_type:n});try{const E=fetch(route("super.reports.generate_report"),{method:"POST",body:j}).then(c=>c.json()).then(c=>{var T;f(c.data),y(c.keys),i(null),((T=c.data)==null?void 0:T.length)>0?d.success("Report has been generated!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"}):d.error("No data could be find based on your query!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})},c=>{i(null),d.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})})}catch{i(null),d.error("Something went wrong! Please try again :(",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}}},m=t=>{b(t.target.value)},x=t=>{d.warning("Please select a "+t+" first!",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})};return l.useEffect(()=>{U(),z(),W()},[]),e.jsxs(te,{user:G.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Reports"}),children:[e.jsx(ee,{title:"Reports"}),e.jsx(se,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"light"}),e.jsx("div",{className:"page-header d-print-none",children:e.jsx("div",{className:"container-xl",children:e.jsx("div",{className:"row g-2 align-items-center",children:e.jsx("div",{className:"col",children:e.jsx("h2",{className:"page-title",children:"Reports"})})})})}),e.jsx("div",{className:"page-body",children:e.jsxs("div",{className:"container-xl",children:[e.jsxs("div",{className:"row row-deck row-cards",children:[e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{className:"form-label",children:"Select Centre"}),e.jsx(g,{options:H,value:u,name:"centreID",onChange:_})]})}),e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"Data Frequency"}),e.jsxs("div",{children:[e.jsxs("label",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"data_freq",value:"Daily",checked:r=="Daily",onChange:m}),e.jsx("span",{className:"form-check-label",children:"Daily"})]}),e.jsxs("label",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"data_freq",value:"Yearly",checked:r=="Yearly",onChange:m}),e.jsx("span",{className:"form-check-label",children:"Yearly"})]}),e.jsxs("label",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"data_freq",value:"Monthly",checked:r=="Monthly",onChange:m}),e.jsx("span",{className:"form-check-label",children:"Monthly"})]}),e.jsxs("label",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"data_freq",value:"Custom Date Range",checked:r=="Custom Date Range",onChange:m}),e.jsx("span",{className:"form-check-label",children:"Custom Date Range"})]})]})]})}),r=="Daily"?e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"Choose Date"}),e.jsx("input",{className:"form-control",type:"date",name:"daily_date",value:N,onChange:t=>C(t.target.value)})]})}):r=="Monthly"?e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"Choose Month(s)"}),e.jsx(g,{options:Q,value:w,name:"monthly_date",onChange:S})]})}):r=="Yearly"?e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"Choose Year"}),e.jsx("input",{className:"form-control",type:"text",name:"yearly_date",placeholder:"Enter Year e.g. 2024",value:D,onChange:t=>k(t.target.value)})]})}):r=="Custom Date Range"?e.jsxs("div",{className:"col-sm-6 col-lg-3",style:{justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"From"}),e.jsx("input",{className:"form-control form-date-picker",type:"date",name:"from_date_range",value:F,onChange:t=>O(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"form-label",children:"To"}),e.jsx("input",{className:"form-control",type:"date",name:"to_date_range",value:M,onChange:t=>R(t.target.value)})]})]}):e.jsx(e.Fragment,{})]}),e.jsxs("div",{className:"row row-deck row-cards",children:[e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{className:"form-label",children:"Report Type"}),e.jsx(g,{options:J,value:n,name:"report_type",onChange:Y})]})}),e.jsx("div",{className:"col-sm-6 col-lg-3",children:e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{className:"form-label",children:"Countries"}),e.jsx(g,{options:K,value:q,name:"country",isMulti:!0,onChange:P})]})})]}),e.jsx("div",{className:"mt-3 row row-deck row-cards mb-3",style:{justifyContent:"flex-end"},children:e.jsx("div",{className:"col-sm-6 col-lg-3",style:{justifyContent:"space-between"},children:e.jsxs("div",{className:"col-12",style:{display:"inline-flex",justifyContent:"space-between"},children:[e.jsx("button",{type:"submit",className:"btn btn-primary",onClick:Z,disabled:V!==null,children:"Generate Report"}),e.jsx("button",{type:"submit",className:"btn btn-secondary",disabled:u==0&&n==0&&r==null,onClick:X,children:"Reset Selection"})]})})}),(h==null?void 0:h.length)>0?e.jsx("div",{className:"row row-deck row-cards",children:e.jsxs("div",{class:"card",children:[e.jsxs("div",{className:"card-header",style:{display:"inline-flex",justifyContent:"space-between"},children:[e.jsxs("h2",{class:"page-title",children:[n==null?void 0:n.label," - Result"]}),e.jsxs("div",{children:[e.jsxs("button",{className:"btn btn-sm btn-success text-white mr-2",children:["Export CSV",e.jsx(B,{})]}),e.jsxs("button",{className:"btn btn-sm btn-danger text-white ml-2",children:["Export PDF",e.jsx(B,{})]})]})]}),e.jsx("div",{class:"card-body",children:e.jsx("div",{id:"table-default",class:"table-responsive",children:e.jsxs("table",{class:"table",children:[e.jsx("thead",{children:e.jsx("tr",{children:v.map((t,a)=>e.jsx("th",{children:e.jsx("button",{class:"table-sort","data-sort":"sort-name",children:t.name.replaceAll("_"," ")})}))})}),e.jsx("tbody",{class:"table-tbody",children:h.map((t,a)=>e.jsx("tr",{children:v.map((j,E)=>e.jsx("td",{class:"sort-name",children:t[j.name]}))}))})]})})})]})}):e.jsx(e.Fragment,{})]})})]})}export{de as default};
